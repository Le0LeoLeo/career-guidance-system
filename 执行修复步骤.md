# ✅ 修复步骤执行指南

## ✅ 步骤 1：Edge Function 已部署（已完成）

Edge Function 已成功部署到 Supabase！

## ⚠️ 步骤 2：添加数据库字段（需要你手动执行）

请在 Supabase Dashboard 中执行以下 SQL：

### 方法 1：使用我创建的 SQL 文件
1. 打开 Supabase Dashboard: https://supabase.com/dashboard/project/naqyczuuariosniudbsr
2. 点击左侧菜单的 **SQL Editor**
3. 点击 **New query**
4. 复制并粘贴以下 SQL：

```sql
ALTER TABLE profiles 
ADD COLUMN IF NOT EXISTS target_university_name TEXT;
```

5. 点击 **Run** 执行

### 方法 2：直接使用文件
打开项目中的 `add_target_university_name_field.sql` 文件，复制内容到 SQL Editor 执行。

## ✅ 步骤 3：重新设定目标（建议执行）

在应用中重新设定一次目标大学和科系，这样：
- 大学名称会被保存到 `target_university_name` 字段
- 确保数据完整性

## 🧪 步骤 4：测试验证

1. 在应用中设定目标大学和科系
2. 问 AI：「我的理想大学是什么？」
3. AI 应该直接回答：「根据你的目标设定，你的理想大学是 [大学名称]，目标科系是 [科系名称]」

---

## 📋 已完成的修改总结

1. ✅ **Edge Function 已更新并部署**
   - 强化系统提示词，要求 AI 必须使用用户数据
   - 添加 `target_university_name` 字段查询
   - 添加详细调试日志

2. ✅ **创建了 SQL 文件**
   - `add_target_university_name_field.sql` - 可直接在 Supabase 中执行

3. ⏳ **待执行：数据库字段添加**
   - 需要在 Supabase Dashboard 中执行 SQL

---

## 🔍 如果还有问题

如果执行完所有步骤后仍有问题，可以：

1. **检查 Edge Function 日志**
   - Supabase Dashboard → Edge Functions → ask-ai → Logs
   - 查看是否有错误信息

2. **检查数据库数据**
   - Supabase Dashboard → Table Editor → profiles
   - 确认你的用户记录中有 `target_university_name` 字段和值

3. **检查浏览器控制台**
   - 打开开发者工具（F12）
   - 查看 Console 标签，确认是否有错误

